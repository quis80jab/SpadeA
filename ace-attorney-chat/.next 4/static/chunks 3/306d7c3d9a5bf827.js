(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32545,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),l=e.i(46932),s=e.i(11795);function i(){let e=(0,r.useRouter)(),i=(0,s.createClient)(),[o,n]=(0,a.useState)(null),[c,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(!0),[p,x]=(0,a.useState)(!1),[h,v]=(0,a.useState)(!1),[b,y]=(0,a.useState)(null),[f,g]=(0,a.useState)(null),[j,k]=(0,a.useState)(!1),N=(0,a.useRef)(null),[w,C]=(0,a.useState)("dark"),[S,_]=(0,a.useState)(!0),T=(0,a.useRef)(null),[L,P]=(0,a.useState)(null),[A,B]=(0,a.useState)(!1);(0,a.useEffect)(()=>{!async function(){let{data:{user:t}}=await i.auth.getUser();if(!t)return e.replace("/login");let{data:a}=await i.from("profiles").select("*").eq("id",t.id).single();a&&(n(a),d(a.display_name),C(a.theme||"dark"),_(a.arguments_public_by_default),P(a.avatar_url||null)),m(!1)}()},[]);let E=(0,a.useCallback)(e=>{if(N.current&&clearTimeout(N.current),!e.trim()||e.trim()===o?.display_name){g(null),k(!1);return}k(!0),N.current=setTimeout(async()=>{let{data:t}=await i.from("profiles").select("id").eq("display_name",e.trim()).neq("id",o?.id??"").limit(1);g(!t||0===t.length),k(!1)},500)},[o,i]),U=async e=>{let t=e.target.files?.[0];if(t&&o){B(!0),y(null);try{let e=t.name.split(".").pop(),a=`${o.id}/avatar.${e}`,{error:r}=await i.storage.from("avatars").upload(a,t,{upsert:!0});if(r){y("Avatar upload failed. Storage bucket may not be configured."),B(!1);return}let{data:l}=i.storage.from("avatars").getPublicUrl(a),s=l.publicUrl+"?t="+Date.now();P(s),await i.from("profiles").update({avatar_url:s}).eq("id",o.id)}catch{y("Failed to upload avatar.")}B(!1)}},q=async()=>{if(!o||p)return;let e=c.trim()||o.display_name;if(e!==o.display_name&&!1===f)return void y("That display name is already taken.");x(!0),v(!1),y(null);let{error:t}=await i.from("profiles").update({display_name:e,arguments_public_by_default:S,theme:w}).eq("id",o.id);if(t){y("Failed to save. Please try again."),x(!1);return}n({...o,display_name:e,arguments_public_by_default:S,theme:w}),"light"===w?document.documentElement.classList.add("light"):document.documentElement.classList.remove("light"),localStorage.setItem("ace_theme",w),x(!1),v(!0),g(null),setTimeout(()=>v(!1),2e3)},R=async()=>{await i.auth.signOut(),document.documentElement.classList.remove("light"),localStorage.removeItem("ace_theme"),e.push("/"),e.refresh()};return u?(0,t.jsx)("div",{className:"flex items-center justify-center h-dvh",style:{background:"var(--bg)"},children:(0,t.jsx)("div",{className:"w-6 h-6 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--primary)",borderTopColor:"transparent"}})}):o?(0,t.jsxs)("div",{className:"flex flex-col h-dvh",style:{background:"var(--bg)"},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 px-5 py-3.5 shrink-0",style:{borderBottom:"1px solid var(--border-subtle)"},children:[(0,t.jsxs)("button",{onClick:()=>e.push("/profile"),className:"text-sm px-3.5 py-1.5 rounded-full border cursor-pointer transition-all duration-150",style:{borderColor:"var(--chip-border)",color:"var(--text-secondary)"},children:[(0,t.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"inline mr-1 -mt-0.5",children:(0,t.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",strokeLinecap:"round",strokeLinejoin:"round"})}),"Back"]}),(0,t.jsx)("h1",{className:"text-sm font-medium flex-1",style:{color:"var(--text-primary)"},children:"Settings"})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsxs)(l.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"px-6 py-6 flex flex-col gap-6 max-w-lg mx-auto",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,t.jsxs)("button",{onClick:()=>T.current?.click(),className:"relative w-20 h-20 rounded-full overflow-hidden cursor-pointer group transition-all duration-200",style:{background:"var(--bg-card)",border:"2px solid var(--border-subtle)"},children:[L?(0,t.jsx)("img",{src:L,alt:"Avatar",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-2xl font-semibold",style:{color:"var(--primary)"},children:(c??"?").charAt(0).toUpperCase()}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,t.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",children:[(0,t.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",strokeLinecap:"round",strokeLinejoin:"round"}),(0,t.jsx)("circle",{cx:"12",cy:"13",r:"4"})]})}),A&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"white",borderTopColor:"transparent"}})})]}),(0,t.jsx)("input",{ref:T,type:"file",accept:"image/*",className:"hidden",onChange:U}),(0,t.jsx)("p",{className:"text-xs cursor-pointer hover:underline",style:{color:"var(--text-muted)"},onClick:()=>T.current?.click(),children:L?"Change photo":"Add profile photo"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium tracking-wider uppercase block mb-2",style:{color:"var(--text-muted)"},children:"Display Name"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>{var t;d(t=e.target.value),E(t)},className:"w-full rounded-xl px-4 py-3 text-sm border outline-none placeholder:text-[var(--text-muted)] transition-colors duration-150",style:{background:"var(--bg-light)",borderColor:!1===f?"var(--primary)":!0===f?"var(--take-that)":"var(--border-subtle)",color:"var(--text-primary)"}}),j&&(0,t.jsx)("p",{className:"text-[11px] mt-1.5",style:{color:"var(--text-muted)"},children:"Checking availability..."}),!j&&!1===f&&(0,t.jsx)("p",{className:"text-[11px] mt-1.5",style:{color:"var(--primary)"},children:"This name is already taken."}),!j&&!0===f&&(0,t.jsx)("p",{className:"text-[11px] mt-1.5",style:{color:"var(--take-that)"},children:"Name is available."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium tracking-wider uppercase block mb-2",style:{color:"var(--text-muted)"},children:"Theme"}),(0,t.jsx)("div",{className:"flex gap-2",children:["dark","light"].map(e=>(0,t.jsx)("button",{onClick:()=>{C(e),"light"===e?document.documentElement.classList.add("light"):document.documentElement.classList.remove("light"),localStorage.setItem("ace_theme",e)},className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all duration-150 cursor-pointer",style:{background:w===e?"var(--hover-overlay)":"var(--bg-light)",color:w===e?"var(--text-primary)":"var(--text-muted)",border:w===e?"1.5px solid var(--selection-border)":"1.5px solid transparent"},children:"dark"===e?"Dark":"Light"},e))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium tracking-wider uppercase block mb-2",style:{color:"var(--text-muted)"},children:"Default Argument Privacy"}),(0,t.jsx)("div",{className:"flex gap-2",children:[{value:!0,label:"Public"},{value:!1,label:"Private"}].map(e=>(0,t.jsx)("button",{onClick:()=>_(e.value),className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all duration-150 cursor-pointer",style:{background:S===e.value?"var(--hover-overlay)":"var(--bg-light)",color:S===e.value?"var(--text-primary)":"var(--text-muted)",border:S===e.value?"1.5px solid var(--selection-border)":"1.5px solid transparent"},children:e.label},String(e.value)))}),(0,t.jsx)("p",{className:"text-[11px] mt-1.5",style:{color:"var(--text-muted)"},children:"Public arguments can be shared and appear on your profile."})]}),b&&(0,t.jsx)("p",{className:"text-xs text-center",style:{color:"var(--primary)"},children:b}),(0,t.jsx)("button",{onClick:q,disabled:p||!1===f,className:"w-full py-3 rounded-xl text-white text-sm font-semibold tracking-wide transition-all duration-200 hover:brightness-110 active:scale-[0.98] cursor-pointer disabled:opacity-50",style:{background:"var(--primary)"},children:p?"Saving...":h?"Saved":"Save Changes"}),(0,t.jsx)("div",{className:"h-px",style:{background:"var(--border-subtle)"}}),(0,t.jsx)("button",{onClick:R,className:"w-full py-3 rounded-xl text-sm font-medium transition-all duration-150 cursor-pointer hover:brightness-95",style:{color:"var(--primary)",border:"1px solid rgba(255,56,92,0.2)"},children:"Sign Out"})]})})]}):null}e.s(["default",()=>i])}]);